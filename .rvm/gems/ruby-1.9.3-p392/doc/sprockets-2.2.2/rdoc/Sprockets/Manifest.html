<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Sprockets::Manifest - sprockets-2.2.2 Documentation</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/sprockets/manifest.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-assets">#assets</a>
    
    <li><a href="#method-i-backups_for">#backups_for</a>
    
    <li><a href="#method-i-clean">#clean</a>
    
    <li><a href="#method-i-clobber">#clobber</a>
    
    <li><a href="#method-i-compile">#compile</a>
    
    <li><a href="#method-i-files">#files</a>
    
    <li><a href="#method-i-find_asset">#find_asset</a>
    
    <li><a href="#method-i-remove">#remove</a>
    
    <li><a href="#method-i-save">#save</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../Sprockets.html">Sprockets</a>
  
    <li><a href="../Sprockets/ArgumentError.html">Sprockets::ArgumentError</a>
  
    <li><a href="../Sprockets/Asset.html">Sprockets::Asset</a>
  
    <li><a href="../Sprockets/AssetAttributes.html">Sprockets::AssetAttributes</a>
  
    <li><a href="../Sprockets/Base.html">Sprockets::Base</a>
  
    <li><a href="../Sprockets/BundledAsset.html">Sprockets::BundledAsset</a>
  
    <li><a href="../Sprockets/Cache.html">Sprockets::Cache</a>
  
    <li><a href="../Sprockets/Cache/FileStore.html">Sprockets::Cache::FileStore</a>
  
    <li><a href="../Sprockets/Caching.html">Sprockets::Caching</a>
  
    <li><a href="../Sprockets/CharsetNormalizer.html">Sprockets::CharsetNormalizer</a>
  
    <li><a href="../Sprockets/CircularDependencyError.html">Sprockets::CircularDependencyError</a>
  
    <li><a href="../Sprockets/ContentTypeMismatch.html">Sprockets::ContentTypeMismatch</a>
  
    <li><a href="../Sprockets/Context.html">Sprockets::Context</a>
  
    <li><a href="../Sprockets/DirectiveProcessor.html">Sprockets::DirectiveProcessor</a>
  
    <li><a href="../Sprockets/EcoTemplate.html">Sprockets::EcoTemplate</a>
  
    <li><a href="../Sprockets/EjsTemplate.html">Sprockets::EjsTemplate</a>
  
    <li><a href="../Sprockets/EncodingError.html">Sprockets::EncodingError</a>
  
    <li><a href="../Sprockets/EngineError.html">Sprockets::EngineError</a>
  
    <li><a href="../Sprockets/Engines.html">Sprockets::Engines</a>
  
    <li><a href="../Sprockets/Environment.html">Sprockets::Environment</a>
  
    <li><a href="../Sprockets/Error.html">Sprockets::Error</a>
  
    <li><a href="../Sprockets/FileNotFound.html">Sprockets::FileNotFound</a>
  
    <li><a href="../Sprockets/FileOutsidePaths.html">Sprockets::FileOutsidePaths</a>
  
    <li><a href="../Sprockets/Index.html">Sprockets::Index</a>
  
    <li><a href="../Sprockets/JstProcessor.html">Sprockets::JstProcessor</a>
  
    <li><a href="../Sprockets/Manifest.html">Sprockets::Manifest</a>
  
    <li><a href="../Sprockets/Mime.html">Sprockets::Mime</a>
  
    <li><a href="../Sprockets/ProcessedAsset.html">Sprockets::ProcessedAsset</a>
  
    <li><a href="../Sprockets/ProcessedAsset/DependencyFile.html">Sprockets::ProcessedAsset::DependencyFile</a>
  
    <li><a href="../Sprockets/Processing.html">Sprockets::Processing</a>
  
    <li><a href="../Sprockets/Processor.html">Sprockets::Processor</a>
  
    <li><a href="../Sprockets/SafetyColons.html">Sprockets::SafetyColons</a>
  
    <li><a href="../Sprockets/Server.html">Sprockets::Server</a>
  
    <li><a href="../Sprockets/StaticAsset.html">Sprockets::StaticAsset</a>
  
    <li><a href="../Sprockets/Trail.html">Sprockets::Trail</a>
  
    <li><a href="../Sprockets/UnserializeError.html">Sprockets::UnserializeError</a>
  
    <li><a href="../Sprockets/Utils.html">Sprockets::Utils</a>
  
    <li><a href="../Rake.html">Rake</a>
  
    <li><a href="../Rake/SprocketsTask.html">Rake::SprocketsTask</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Sprockets::Manifest</h1>

  <div id="description" class="description">
    
<p>The <a href="Manifest.html">Manifest</a> logs the contents of assets
compiled to a single directory. It records basic attributes about the asset
for fast lookup without having to compile. A pointer from each logical path
indicates with fingerprinted asset is the current one.</p>

<p>The JSON is part of the public API and should be considered stable. This
should make it easy to read from other programming languages and processes
that don’t have sprockets loaded. See `<a
href="Manifest.html#method-i-assets">assets</a>` and `<a
href="Manifest.html#method-i-files">files</a>` for more infomation about
the structure.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-dir" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">dir</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-environment" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">environment</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-path" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">path</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(environment, path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Create new <a href="Manifest.html">Manifest</a> associated with an
`environment`. `path` is a full path to the manifest json file. The file
may or may not already exist. The dirname of the `path` will be used to
write compiled assets to. Otherwise, if the path is a directory, the
filename will default to “manifest.json” in that directory.</p>

<pre>Manifest.new(environment, &quot;./public/assets/manifest.json&quot;)</pre>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">environment</span>, <span class="ruby-identifier">path</span>)
  <span class="ruby-ivar">@environment</span> = <span class="ruby-identifier">environment</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@dir</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-ivar">@path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@dir</span>, <span class="ruby-string">'manifest.json'</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-ivar">@dir</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-ivar">@path</span>)
      <span class="ruby-identifier">data</span> = <span class="ruby-constant">MultiJson</span>.<span class="ruby-identifier">decode</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@path</span>))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">MultiJson</span><span class="ruby-operator">::</span><span class="ruby-constant">DecodeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;#{@path} is invalid: #{e.class} #{e.message}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">:</span> {}
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-assets" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assets</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns internal assets mapping. Keys are logical paths which map to the
latest fingerprinted filename.</p>

<pre class="ruby"><span class="ruby-constant">Logical</span> <span class="ruby-identifier">path</span> (<span class="ruby-constant">String</span>)<span class="ruby-operator">:</span> <span class="ruby-constant">Fingerprint</span> <span class="ruby-identifier">path</span> (<span class="ruby-constant">String</span>)

{ <span class="ruby-string">&quot;application.js&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js&quot;</span>,
  <span class="ruby-string">&quot;jquery.js&quot;</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;jquery-ae0908555a245f8266f77df5a8edca2e.js&quot;</span> }
</pre>
          

          
          <div class="method-source-code" id="assets-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 57</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assets</span>
  <span class="ruby-ivar">@data</span>[<span class="ruby-string">'assets'</span>] <span class="ruby-operator">||=</span> {}
<span class="ruby-keyword">end</span></pre>
          </div><!-- assets-source -->
          
        </div>

        

        
      </div><!-- assets-method -->

    
      <div id="method-i-clean" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clean</span><span
            class="method-args">(keep = 2)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Cleanup old assets in the compile directory. By default it will keep the
latest version plus 2 backups.</p>
          

          
          <div class="method-source-code" id="clean-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clean</span>(<span class="ruby-identifier">keep</span> = <span class="ruby-value">2</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">assets</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">logical_path</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Get assets sorted by ctime, newest first</span>
    <span class="ruby-identifier">assets</span> = <span class="ruby-identifier">backups_for</span>(<span class="ruby-identifier">logical_path</span>)

    <span class="ruby-comment"># Keep the last N backups</span>
    <span class="ruby-identifier">assets</span> = <span class="ruby-identifier">assets</span>[<span class="ruby-identifier">keep</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-operator">||</span> []

    <span class="ruby-comment"># Remove old assets</span>
    <span class="ruby-identifier">assets</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove</span>(<span class="ruby-identifier">path</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- clean-source -->
          
        </div>

        

        
      </div><!-- clean-method -->

    
      <div id="method-i-clobber" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clobber</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Wipe directive</p>
          

          
          <div class="method-source-code" id="clobber-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 152</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clobber</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span>(<span class="ruby-ivar">@dir</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-ivar">@dir</span>)
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Removed #{@dir}&quot;</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- clobber-source -->
          
        </div>

        

        
      </div><!-- clobber-method -->

    
      <div id="method-i-compile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">compile</span><span
            class="method-args">(*args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Compile and write asset to directory. The asset is written to a
fingerprinted filename like
`application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js`. An entry is also
inserted into the manifest file.</p>

<pre>compile(&quot;application.js&quot;)</pre>
          

          
          <div class="method-source-code" id="compile-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">compile</span>(*<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">paths</span> = <span class="ruby-identifier">environment</span>.<span class="ruby-identifier">each_logical_path</span>(*<span class="ruby-identifier">args</span>).<span class="ruby-identifier">to_a</span> <span class="ruby-operator">+</span>
    <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">fn</span><span class="ruby-operator">|</span> <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">fn</span>).<span class="ruby-identifier">absolute?</span> }

  <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">asset</span> = <span class="ruby-identifier">find_asset</span>(<span class="ruby-identifier">path</span>)
      <span class="ruby-identifier">files</span>[<span class="ruby-identifier">asset</span>.<span class="ruby-identifier">digest_path</span>] = {
        <span class="ruby-string">'logical_path'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">asset</span>.<span class="ruby-identifier">logical_path</span>,
        <span class="ruby-string">'mtime'</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">asset</span>.<span class="ruby-identifier">mtime</span>.<span class="ruby-identifier">iso8601</span>,
        <span class="ruby-string">'digest'</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">asset</span>.<span class="ruby-identifier">digest</span>
      }
      <span class="ruby-identifier">assets</span>[<span class="ruby-identifier">asset</span>.<span class="ruby-identifier">logical_path</span>] = <span class="ruby-identifier">asset</span>.<span class="ruby-identifier">digest_path</span>

      <span class="ruby-identifier">target</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">asset</span>.<span class="ruby-identifier">digest_path</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">target</span>)
        <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Skipping #{target}, already exists&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Writing #{target}&quot;</span>
        <span class="ruby-identifier">asset</span>.<span class="ruby-identifier">write_to</span> <span class="ruby-identifier">target</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">save</span>
      <span class="ruby-identifier">asset</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- compile-source -->
          
        </div>

        

        
      </div><!-- compile-method -->

    
      <div id="method-i-files" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">files</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns internal file directory listing. Keys are filenames which map to an
attributes array.</p>

<pre class="ruby"> <span class="ruby-constant">Fingerprint</span> <span class="ruby-identifier">path</span> (<span class="ruby-constant">String</span>)<span class="ruby-operator">:</span>
   <span class="ruby-identifier">logical_path</span><span class="ruby-operator">:</span> <span class="ruby-constant">Logical</span> <span class="ruby-identifier">path</span> (<span class="ruby-constant">String</span>)
   <span class="ruby-identifier">mtime</span><span class="ruby-operator">:</span> <span class="ruby-constant">ISO8601</span> <span class="ruby-identifier">mtime</span> (<span class="ruby-constant">String</span>)
   <span class="ruby-identifier">digest</span><span class="ruby-operator">:</span> <span class="ruby-constant">Base64</span> <span class="ruby-identifier">hex</span> <span class="ruby-identifier">digest</span> (<span class="ruby-constant">String</span>)

{ <span class="ruby-string">&quot;application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js&quot;</span> =<span class="ruby-operator">&gt;</span>
    { <span class="ruby-string">'logical_path'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;application.js&quot;</span>,
      <span class="ruby-string">'mtime'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;2011-12-13T21:47:08-06:00&quot;</span>,
      <span class="ruby-string">'digest'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;2e8e9a7c6b0aafa0c9bdeec90ea30213&quot;</span> } }
</pre>
          

          
          <div class="method-source-code" id="files-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">files</span>
  <span class="ruby-ivar">@data</span>[<span class="ruby-string">'files'</span>] <span class="ruby-operator">||=</span> {}
<span class="ruby-keyword">end</span></pre>
          </div><!-- files-source -->
          
        </div>

        

        
      </div><!-- files-method -->

    
      <div id="method-i-remove" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove</span><span
            class="method-args">(filename)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Removes file from directory and from manifest. `filename` must be the name
with any directory path.</p>

<pre>manifest.remove(&quot;application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js&quot;)</pre>
          

          
          <div class="method-source-code" id="remove-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">filename</span>)
  <span class="ruby-identifier">logical_path</span> = <span class="ruby-identifier">files</span>[<span class="ruby-identifier">filename</span>][<span class="ruby-string">'logical_path'</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">assets</span>[<span class="ruby-identifier">logical_path</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">assets</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">logical_path</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)

  <span class="ruby-identifier">save</span>

  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Removed #{filename}&quot;</span>

  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove-source -->
          
        </div>

        

        
      </div><!-- remove-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-backups_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">backups_for</span><span
            class="method-args">(logical_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Finds all the backup assets for a logical path. The latest version is
always excluded. The return array is sorted by the assets mtime in
descending order (Newest to oldest).</p>
          

          
          <div class="method-source-code" id="backups_for-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">backups_for</span>(<span class="ruby-identifier">logical_path</span>)
  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span>, <span class="ruby-identifier">attrs</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Matching logical paths</span>
    <span class="ruby-identifier">attrs</span>[<span class="ruby-string">'logical_path'</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">logical_path</span> <span class="ruby-operator">&amp;&amp;</span>
      <span class="ruby-comment"># Excluding whatever asset is the current</span>
      <span class="ruby-identifier">assets</span>[<span class="ruby-identifier">logical_path</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">filename</span>
  }.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span>, <span class="ruby-identifier">attrs</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Sort by timestamp</span>
    <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">attrs</span>[<span class="ruby-string">'mtime'</span>])
  }.<span class="ruby-identifier">reverse</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- backups_for-source -->
          
        </div>

        

        
      </div><!-- backups_for-method -->

    
      <div id="method-i-find_asset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_asset</span><span
            class="method-args">(logical_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Basic wrapper around <a
href="Environment.html#method-i-find_asset">Sprockets::Environment#find_asset</a>.
Logs compile time.</p>
          

          
          <div class="method-source-code" id="find_asset-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 175</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_asset</span>(<span class="ruby-identifier">logical_path</span>)
  <span class="ruby-identifier">asset</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">ms</span> = <span class="ruby-identifier">benchmark</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">asset</span> = <span class="ruby-identifier">environment</span>.<span class="ruby-identifier">find_asset</span>(<span class="ruby-identifier">logical_path</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Compiled #{logical_path}  (#{ms}ms)&quot;</span>
  <span class="ruby-identifier">asset</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_asset-source -->
          
        </div>

        

        
      </div><!-- find_asset-method -->

    
      <div id="method-i-save" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Persist manfiest back to FS</p>
          

          
          <div class="method-source-code" id="save-source">
            <pre><span class="ruby-comment"># File lib/sprockets/manifest.rb, line 185</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-string">'w'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-constant">MultiJson</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-ivar">@data</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- save-source -->
          
        </div>

        

        
      </div><!-- save-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

